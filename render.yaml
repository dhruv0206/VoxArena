# VoxArena — Render Infrastructure as Code
# Docs: https://docs.render.com/infrastructure-as-code
#
# SETUP: After first deploy, update placeholder URLs with actual Render URLs
# and set all secrets (sync: false) via the Render dashboard.

databases:
  - name: voxarena-db
    plan: basic_256mb
    databaseName: voxarena
    user: voxarena
    region: oregon

services:
  # ── Backend API (FastAPI) ─────────────────────────────────
  - type: web
    name: voxarena-backend
    runtime: docker
    rootDir: backend
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: starter
    region: oregon
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: voxarena-db
          property: connectionString
      - key: FRONTEND_URL
        sync: false
      - key: LIVEKIT_API_KEY
        sync: false
      - key: LIVEKIT_API_SECRET
        sync: false
      - key: LIVEKIT_URL
        sync: false
      - key: RESEMBLE_API_KEY
        sync: false
      - key: TWILIO_ACCOUNT_SID
        sync: false
      - key: TWILIO_AUTH_TOKEN
        sync: false
      - key: TWILIO_SIP_DOMAIN
        sync: false
      - key: LIVEKIT_SIP_TRUNK_ID
        sync: false
      - key: DEBUG
        value: "false"

  # ── Frontend (Next.js — native Node runtime) ──────────────
  - type: web
    name: voxarena-frontend
    runtime: node
    rootDir: frontend
    buildCommand: npm ci && npm run build
    startCommand: npm start
    plan: starter
    region: oregon
    envVars:
      - key: NEXT_PUBLIC_API_URL
        sync: false
      - key: INTERNAL_API_URL
        sync: false
      - key: NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY
        sync: false
      - key: CLERK_SECRET_KEY
        sync: false
      - key: NEXT_PUBLIC_CLERK_SIGN_IN_URL
        value: /sign-in
      - key: NEXT_PUBLIC_CLERK_SIGN_UP_URL
        value: /sign-up
      - key: NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL
        value: /dashboard
      - key: NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL
        value: /dashboard
      - key: LIVEKIT_API_KEY
        sync: false
      - key: LIVEKIT_API_SECRET
        sync: false
      - key: LIVEKIT_URL
        sync: false
      - key: DEEPGRAM_API_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: NODE_VERSION
        value: "20"

  # ── Voice Agent (LiveKit Background Worker) ───────────────
  - type: worker
    name: voxarena-agent
    runtime: docker
    rootDir: agent
    dockerfilePath: ./Dockerfile
    dockerContext: .
    plan: starter
    region: oregon
    envVars:
      - key: BACKEND_API_URL
        sync: false
      - key: LIVEKIT_API_KEY
        sync: false
      - key: LIVEKIT_API_SECRET
        sync: false
      - key: LIVEKIT_URL
        sync: false
      - key: ASSEMBLYAI_API_KEY
        sync: false
      - key: DEEPGRAM_API_KEY
        sync: false
      - key: ELEVENLABS_API_KEY
        sync: false
      - key: GOOGLE_API_KEY
        sync: false
      - key: RESEMBLE_API_KEY
        sync: false
      - key: RESEMBLE_PROJECT_UUID
        sync: false
      - key: RESEMBLE_VOICE_UUID
        sync: false
